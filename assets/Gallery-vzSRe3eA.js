import{R as fe,r as i,j as r,i as q}from"./index-ZVYxoX19.js";import{c as _e,L as Te,u as ke}from"./image-6-GkjZDO.js";import{c as ge,a as M}from"./motion-minimal-jJCu8YKk.js";import{t as he}from"./lodash-lrAbnKsZ.js";import{a as F,j as pe,o as te,p as ve,q as ce}from"./request-MvzBsxCw.js";import{c as Me}from"./StyledButton-BX-nC1hJ.js";import{u as We}from"./viewport-1IkFLRB6.js";import{u as De,D as le}from"./use-is-unmounted-kDYnHtGR.js";import{a as Fe}from"./env-y9k74Ds6.js";const $e=({contexts:t,children:e})=>t.reduceRight((o,a)=>fe.cloneElement(a,{children:o}),e),Z=typeof window<"u"?i.useLayoutEffect:i.useEffect,Be=F(!1),Ge=t=>pe.set(Be,t),ye=t=>{const e=(o,a=[])=>te(ve(t,i.useCallback(c=>o(c),a)));return e.__atom=t,e},xe=F(0),ne=F(null),Mt=({children:t})=>r.jsxs(r.Fragment,{children:[r.jsx(Ue,{}),t]}),Ue=()=>{const t=ce(xe),e=ce(ne),o=i.useRef(0),a=i.useRef(!1);return Z(()=>{const c=he(()=>{a.current||(Ge(!0),a.current=!0);const u=document.documentElement.scrollTop;e(o.current-u>0?"up":"down"),o.current=u,i.startTransition(()=>{t(o.current)})},16,{leading:!1});return window.addEventListener("scroll",c),c(),()=>{window.removeEventListener("scroll",c)}},[]),null},Ye=()=>te(ne),Wt=ye(xe);ye(ne);const ee=t=>{const e=i.useRef(t);return i.useEffect(()=>{e.current=t},[t]),e},qe=t=>{const e=i.useRef();return e.current||(e.current=t()),e.current},ze=i.createContext(F([])),Dt=({children:t,images:e})=>{const o=qe(()=>F(e));return i.useEffect(()=>{pe.set(o,e)},[e]),r.jsx(ze.Provider,{value:o,children:t})},oe=t=>te(ve(i.useContext(ze),i.useCallback(e=>e.find(o=>o.src===t),[t]))),[Ze,Ve,Xe]=q(void 0),[Ke,Qe,Je]=q({h:0,w:0}),[et,Ft,tt]=q({x:0,y:0}),[nt,$t,ot]=q(!1),rt=[r.jsx(Ze,{},"ArticleElementProviderInternal"),r.jsx(Ke,{},"ElementSizeProviderInternal"),r.jsx(et,{},"ElementPositionProviderInternal"),r.jsx(nt,{},"IsEOArticleElementProviderInternal")],Bt=({children:t,className:e,...o})=>r.jsxs($e,{contexts:rt,children:[r.jsx(at,{}),r.jsx(Ee,{...o,className:e,children:t})]}),at=()=>{const t=Je(),e=tt(),o=Ve();return Z(()=>{if(!o)return;const{height:a,width:c,x:u,y}=o.getBoundingClientRect();t({h:a,w:c}),e({x:u,y});const m=new ResizeObserver(E=>{const x=E[0],{height:h,width:L,x:N,y:A}=x.contentRect;t({h,w:L}),e({x:N,y:A})});return m.observe(o),()=>{m.unobserve(o),m.disconnect()}},[o]),null},Ee=i.memo(({children:t,className:e,eoaDetect:o,as:a="div"})=>{const c=Xe(),u=a;return r.jsxs(u,{className:ge("relative",e),ref:c,children:[t,o&&r.jsx(it,{})]})});Ee.displayName="ArticleElementProviderContent";const it=()=>{const t=Ye(),e=ee(t),o=ot(),a=i.useRef(null);return i.useEffect(()=>{if(!a.current)return;const c=a.current,u=new IntersectionObserver(y=>{const m=y[0];!m.isIntersecting&&e.current==="down"||o(m.isIntersecting)},{rootMargin:"0px 0px 0px 0px"});return u.observe(c),()=>{u.unobserve(c),u.disconnect()}},[]),r.jsx("div",{ref:a})};/*! medium-zoom 1.1.0 | MIT License | https://github.com/francoischalifour/medium-zoom */var P=Object.assign||function(t){for(var e=1;e<arguments.length;e++){var o=arguments[e];for(var a in o)Object.prototype.hasOwnProperty.call(o,a)&&(t[a]=o[a])}return t},G=function(e){return e.tagName==="IMG"},st=function(e){return NodeList.prototype.isPrototypeOf(e)},U=function(e){return e&&e.nodeType===1},de=function(e){var o=e.currentSrc||e.src;return o.substr(-4).toLowerCase()===".svg"},ue=function(e){try{return Array.isArray(e)?e.filter(G):st(e)?[].slice.call(e).filter(G):U(e)?[e].filter(G):typeof e=="string"?[].slice.call(document.querySelectorAll(e)).filter(G):[]}catch{throw new TypeError(`The provided selector is invalid.
Expects a CSS selector, a Node element, a NodeList or an array.
See: https://github.com/francoischalifour/medium-zoom`)}},ct=function(e){var o=document.createElement("div");return o.classList.add("medium-zoom-overlay"),o.style.background=e,o},lt=function(e){var o=e.getBoundingClientRect(),a=o.top,c=o.left,u=o.width,y=o.height,m=e.cloneNode(),E=window.pageYOffset||document.documentElement.scrollTop||document.body.scrollTop||0,x=window.pageXOffset||document.documentElement.scrollLeft||document.body.scrollLeft||0;return m.removeAttribute("id"),m.style.position="absolute",m.style.top=a+E+"px",m.style.left=c+x+"px",m.style.width=u+"px",m.style.height=y+"px",m.style.transform="",m},k=function(e,o){var a=P({bubbles:!1,cancelable:!1,detail:void 0},o);if(typeof window.CustomEvent=="function")return new CustomEvent(e,a);var c=document.createEvent("CustomEvent");return c.initCustomEvent(e,a.bubbles,a.cancelable,a.detail),c},dt=function t(e){var o=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},a=window.Promise||function(s){function l(){}s(l,l)},c=function(s){var l=s.target;if(l===$){w();return}z.indexOf(l)!==-1&&R({target:l})},u=function(){if(!(_||!n.original)){var s=window.pageYOffset||document.documentElement.scrollTop||document.body.scrollTop||0;Math.abs(ie-s)>f.scrollOffset&&setTimeout(w,150)}},y=function(s){var l=s.key||s.keyCode;(l==="Escape"||l==="Esc"||l===27)&&w()},m=function(){var s=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},l=s;if(s.background&&($.style.background=s.background),s.container&&s.container instanceof Object&&(l.container=P({},f.container,s.container)),s.template){var g=U(s.template)?s.template:document.querySelector(s.template);l.template=g}return f=P({},f,l),z.forEach(function(v){v.dispatchEvent(k("medium-zoom:update",{detail:{zoom:b}}))}),b},E=function(){var s=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return t(P({},f,s))},x=function(){for(var s=arguments.length,l=Array(s),g=0;g<s;g++)l[g]=arguments[g];var v=l.reduce(function(d,j){return[].concat(d,ue(j))},[]);return v.filter(function(d){return z.indexOf(d)===-1}).forEach(function(d){z.push(d),d.classList.add("medium-zoom-image")}),p.forEach(function(d){var j=d.type,O=d.listener,T=d.options;v.forEach(function(H){H.addEventListener(j,O,T)})}),b},h=function(){for(var s=arguments.length,l=Array(s),g=0;g<s;g++)l[g]=arguments[g];n.zoomed&&w();var v=l.length>0?l.reduce(function(d,j){return[].concat(d,ue(j))},[]):z;return v.forEach(function(d){d.classList.remove("medium-zoom-image"),d.dispatchEvent(k("medium-zoom:detach",{detail:{zoom:b}}))}),z=z.filter(function(d){return v.indexOf(d)===-1}),b},L=function(s,l){var g=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};return z.forEach(function(v){v.addEventListener("medium-zoom:"+s,l,g)}),p.push({type:"medium-zoom:"+s,listener:l,options:g}),b},N=function(s,l){var g=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};return z.forEach(function(v){v.removeEventListener("medium-zoom:"+s,l,g)}),p=p.filter(function(v){return!(v.type==="medium-zoom:"+s&&v.listener.toString()===l.toString())}),b},A=function(){var s=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},l=s.target,g=function(){var d={width:document.documentElement.clientWidth,height:document.documentElement.clientHeight,left:0,top:0,right:0,bottom:0},j=void 0,O=void 0;if(f.container)if(f.container instanceof Object)d=P({},d,f.container),j=d.width-d.left-d.right-f.margin*2,O=d.height-d.top-d.bottom-f.margin*2;else{var T=U(f.container)?f.container:document.querySelector(f.container),H=T.getBoundingClientRect(),V=H.width,Ie=H.height,Ae=H.left,Se=H.top;d=P({},d,{width:V,height:Ie,left:Ae,top:Se})}j=j||d.width-f.margin*2,O=O||d.height-f.margin*2;var D=n.zoomedHd||n.original,je=de(D)?j:D.naturalWidth||j,Ce=de(D)?O:D.naturalHeight||O,B=D.getBoundingClientRect(),Le=B.top,Re=B.left,X=B.width,K=B.height,Oe=Math.min(Math.max(X,je),j)/X,Ne=Math.min(Math.max(K,Ce),O)/K,Q=Math.min(Oe,Ne),He=(-Re+(j-X)/2+f.margin+d.left)/Q,Pe=(-Le+(O-K)/2+f.margin+d.top)/Q,se="scale("+Q+") translate3d("+He+"px, "+Pe+"px, 0)";n.zoomed.style.transform=se,n.zoomedHd&&(n.zoomedHd.style.transform=se)};return new a(function(v){if(l&&z.indexOf(l)===-1){v(b);return}var d=function V(){_=!1,n.zoomed.removeEventListener("transitionend",V),n.original.dispatchEvent(k("medium-zoom:opened",{detail:{zoom:b}})),v(b)};if(n.zoomed){v(b);return}if(l)n.original=l;else if(z.length>0){var j=z;n.original=j[0]}else{v(b);return}if(n.original.dispatchEvent(k("medium-zoom:open",{detail:{zoom:b}})),ie=window.pageYOffset||document.documentElement.scrollTop||document.body.scrollTop||0,_=!0,n.zoomed=lt(n.original),document.body.appendChild($),f.template){var O=U(f.template)?f.template:document.querySelector(f.template);n.template=document.createElement("div"),n.template.appendChild(O.content.cloneNode(!0)),document.body.appendChild(n.template)}if(n.original.parentElement&&n.original.parentElement.tagName==="PICTURE"&&n.original.currentSrc&&(n.zoomed.src=n.original.currentSrc),document.body.appendChild(n.zoomed),window.requestAnimationFrame(function(){document.body.classList.add("medium-zoom--opened")}),n.original.classList.add("medium-zoom-image--hidden"),n.zoomed.classList.add("medium-zoom-image--opened"),n.zoomed.addEventListener("click",w),n.zoomed.addEventListener("transitionend",d),n.original.getAttribute("data-zoom-src")){n.zoomedHd=n.zoomed.cloneNode(),n.zoomedHd.removeAttribute("srcset"),n.zoomedHd.removeAttribute("sizes"),n.zoomedHd.removeAttribute("loading"),n.zoomedHd.src=n.zoomed.getAttribute("data-zoom-src"),n.zoomedHd.onerror=function(){clearInterval(T),console.warn("Unable to reach the zoom image target "+n.zoomedHd.src),n.zoomedHd=null,g()};var T=setInterval(function(){n.zoomedHd.complete&&(clearInterval(T),n.zoomedHd.classList.add("medium-zoom-image--opened"),n.zoomedHd.addEventListener("click",w),document.body.appendChild(n.zoomedHd),g())},10)}else if(n.original.hasAttribute("srcset")){n.zoomedHd=n.zoomed.cloneNode(),n.zoomedHd.removeAttribute("sizes"),n.zoomedHd.removeAttribute("loading");var H=n.zoomedHd.addEventListener("load",function(){n.zoomedHd.removeEventListener("load",H),n.zoomedHd.classList.add("medium-zoom-image--opened"),n.zoomedHd.addEventListener("click",w),document.body.appendChild(n.zoomedHd),g()})}else g()})},w=function(){return new a(function(s){if(_||!n.original){s(b);return}var l=function g(){n.original.classList.remove("medium-zoom-image--hidden"),document.body.removeChild(n.zoomed),n.zoomedHd&&document.body.removeChild(n.zoomedHd),document.body.removeChild($),n.zoomed.classList.remove("medium-zoom-image--opened"),n.template&&document.body.removeChild(n.template),_=!1,n.zoomed.removeEventListener("transitionend",g),n.original.dispatchEvent(k("medium-zoom:closed",{detail:{zoom:b}})),n.original=null,n.zoomed=null,n.zoomedHd=null,n.template=null,s(b)};_=!0,document.body.classList.remove("medium-zoom--opened"),n.zoomed.style.transform="",n.zoomedHd&&(n.zoomedHd.style.transform=""),n.template&&(n.template.style.transition="opacity 150ms",n.template.style.opacity=0),n.original.dispatchEvent(k("medium-zoom:close",{detail:{zoom:b}})),n.zoomed.addEventListener("transitionend",l)})},R=function(){var s=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},l=s.target;return n.original?w():A({target:l})},W=function(){return f},I=function(){return z},C=function(){return n.original},z=[],p=[],_=!1,ie=0,f=o,n={original:null,zoomed:null,zoomedHd:null,template:null};Object.prototype.toString.call(e)==="[object Object]"?f=e:(e||typeof e=="string")&&x(e),f=P({margin:0,background:"#fff",scrollOffset:40,container:null,template:null},f);var $=ct(f.background);document.addEventListener("click",c),document.addEventListener("keyup",y),document.addEventListener("scroll",u),window.addEventListener("resize",w);var b={open:A,close:w,toggle:R,update:m,clone:E,attach:x,detach:h,on:L,off:N,getOptions:W,getImages:I,getZoomedImage:C};return b};function ut(t,e){e===void 0&&(e={});var o=e.insertAt;if(!(!t||typeof document>"u")){var a=document.head||document.getElementsByTagName("head")[0],c=document.createElement("style");c.type="text/css",o==="top"&&a.firstChild?a.insertBefore(c,a.firstChild):a.appendChild(c),c.styleSheet?c.styleSheet.cssText=t:c.appendChild(document.createTextNode(t))}}var mt=".medium-zoom-overlay{position:fixed;top:0;right:0;bottom:0;left:0;opacity:0;transition:opacity .3s;will-change:opacity}.medium-zoom--opened .medium-zoom-overlay{cursor:pointer;cursor:zoom-out;opacity:1}.medium-zoom-image{cursor:pointer;cursor:zoom-in;transition:transform .3s cubic-bezier(.2,0,.2,1)!important}.medium-zoom-image--hidden{visibility:hidden}.medium-zoom-image--opened{position:relative;cursor:pointer;cursor:zoom-out;will-change:transform}";ut(mt);const ft=t=>fe.createElement("img",t,t.children),gt="_error_hef56_1",ht="_loading_hef56_2",pt="_loaded_hef56_6",vt="_imageLoad_hef56_1",me={error:gt,loading:ht,loaded:pt,imageLoad:vt},re=Me({base:"rounded-xl overflow-hidden text-center inline-flex items-center justify-center duration-200",variants:{status:{loading:"hidden opacity-0",loaded:"opacity-100 block",error:"hidden opacity-0"}}});let J;const yt=({alt:t,src:e,title:o,zoom:a,placeholder:c,height:u,width:y,className:m})=>{const[E]=i.useState(()=>{if(Fe)return null;if(J)return J;const p=dt(void 0,{});return J=p,p}),x=o||t,[h,L]=i.useState("loading"),N=De(),A=i.useCallback(p=>{N.current||L(p)},[N]),w=i.useRef(null),R=We();Z(()=>{if(h!=="loaded"||!a)return;const p=w.current;if(p){if(R)return p.onclick=()=>{window.open(e)},()=>{p.onclick=null};if(p)return E.attach(p),()=>{E.detach(p)}}},[a,E,h,R]);const W=i.useCallback(()=>{A("loaded")},[A]),I=i.useCallback(()=>A("error"),[A]),C=i.useCallback(p=>{p.target.classList.remove(me.loaded)},[]),z=i.useMemo(()=>re({status:h,className:M(me.loaded,m)}),[m,h]);return r.jsxs("figure",{children:[r.jsx("span",{className:"relative flex justify-center","data-hide-print":!0,children:r.jsxs(Te,{placeholder:c,offset:30,children:[r.jsx("span",{children:h!=="loaded"&&c}),h==="error"&&r.jsxs("div",{className:"absolute inset-0 z-[1] flex flex-col gap-8 center",children:[r.jsx("i",{className:"icon-[mingcute--close-line] text-4xl text-red-500"}),r.jsx("span",{children:"图片加载失败"}),r.jsx(le,{className:"w-[80px] opacity-80"}),r.jsx("a",{href:e,target:"_blank",rel:"noreferrer",children:r.jsx("span",{children:"查看原图"})})]}),r.jsx(be,{height:u,width:y,src:e,title:o,alt:t||o||"",ref:w,onLoad:W,onError:I,className:z,onAnimationEnd:C})]})}),r.jsx("img",{className:"max-w-1/3 !hidden print:!block",src:e,alt:t||o}),!!x&&r.jsxs("figcaption",{className:"mt-1 flex flex-col items-center justify-center",children:[r.jsx(le,{className:"w-[80px] opacity-80"}),r.jsx("span",{children:x})]})]})},xt=t=>{const e=i.useMemo(()=>r.jsx(zt,{...t}),[t]);return r.jsx(yt,{zoom:!0,placeholder:e,...t})},zt=({src:t,containerWidth:e,height:o,width:a,accent:c})=>{const u=oe(t),y=c||u?.accent,m=i.useMemo(()=>{let E=o,x=a;if(!E||!x){if(!u)return;E=u.height,x=u.width}if(e<=0)return;const{height:h,width:L}=_e({width:x,height:E,max:{width:e,height:1/0}});return{scaleHeight:h,scaleWidth:L}},[o,a,e,u]);return m?r.jsx("span",{className:`image-placeholder ${re.base}`,"data-width":m.scaleWidth,"data-height":m.scaleHeight,"data-from-record-height":u?.height,"data-from-record-width":u?.width,"data-src":t,style:{height:m.scaleHeight,width:m.scaleWidth,backgroundColor:y}}):r.jsx(Et,{accent:y})},Et=({accent:t})=>r.jsx("span",{className:ge("image-placeholder",re.base,"h-[300px] w-full bg-slate-300 dark:bg-slate-700"),style:{backgroundColor:t,outline:void 0}}),be=i.memo(i.forwardRef(({src:t,alt:e,...o},a)=>{const{height:c,width:u}=oe(t)||o,y=!!(c&&u),m=i.useRef(null),E=r.jsx("img",{"data-zoom-src":t,alt:e,src:t,ref:m,...o});i.useImperativeHandle(a,()=>m.current);const x=i.useRef(null);return Z(()=>{const h=x.current;h&&m.current&&(m.current.src=h.src)},[t]),r.jsx(r.Fragment,{children:y?r.jsxs(r.Fragment,{children:[r.jsx(ft,{alt:e||"",fetchPriority:"high",priority:!0,src:t,...o,height:+c,width:+u,ref:x}),r.jsx("div",{className:"absolute inset-0 flex justify-center opacity-0",children:i.cloneElement(E,{src:"data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7"})})]}):E})}));be.displayName="OptimizedImage";const bt="_root_1ug9l_1",wt="_indicator_1ug9l_2",It="_container_1ug9l_7",At="_child_1ug9l_17",Y={root:bt,indicator:wt,container:It,child:At},ae=60,St=15,jt=5e3,Gt=t=>{const{images:e}=t,[o,a]=i.useState(null),[,c]=i.useState({}),u=i.useRef(0);i.useEffect(()=>{if(!o)return;const I=new ResizeObserver(()=>{c({}),C(o)});function C(z){const p=z.children.item(0);p&&(u.current=p.clientWidth)}return C(o),I.observe(o),()=>{I.disconnect()}},[o]);const[y,m]=i.useState(0),E=i.useCallback(he(I=>{const C=I.target,z=Math.floor((C.scrollLeft+ae+15)/u.current);m(z)},60),[]),x=i.useCallback(I=>{o&&o.scrollTo({left:u.current*I,behavior:"smooth"})},[o]),h=i.useRef(null),L=ee(y),N=ee(e.length),A=i.useRef(!0),w=i.useRef(!0),R=i.useCallback(()=>{w.current&&(w.current=!1,clearInterval(h.current))},[]),{ref:W}=ke({initialInView:!1,triggerOnce:e.length<2,onChange(I){N.current<2||!w.current||(I?h.current=setInterval(()=>{L.current+1>N.current-1&&A.current&&(A.current=!1),L.current-1<0&&!A.current&&(A.current=!0);const C=L.current+(A.current?1:-1);x(C)},jt):h.current=clearInterval(h.current))}});return i.useEffect(()=>()=>{clearInterval(h.current)},[]),r.jsxs("div",{className:M("w-full","relative",Y.root),ref:W,onTouchMove:R,onWheel:R,children:[r.jsx("div",{className:M("w-full overflow-auto whitespace-nowrap",Y.container),onTouchStart:R,onScroll:E,ref:a,onTouchMove:R,onWheel:R,children:e.map(I=>r.jsx(we,{image:I},I.url))}),r.jsx("div",{className:M(Y.indicator,"space-x-2"),children:Array.from({length:e.length}).map((I,C)=>r.jsx("div",{className:M("h-[6px] w-[6px] cursor-pointer rounded-full bg-stone-600 opacity-50 transition-opacity duration-200 ease-in-out",y==C&&"!opacity-100"),onClick:x.bind(null,C)},C))})]})},Ct={width:`calc(100% - ${ae}px)`,marginRight:`${St}px`},we=i.memo(({image:t})=>{const e=oe(t.url),o=t.name,c=t.footnote||(["!","¡"].some(y=>y==o?.[0])?o?.slice(1):"")||"",{w:u}=Qe();return r.jsx("div",{style:Ct,className:M(Y.child,"inline-block self-center"),children:r.jsx(xt,{accent:e?.accent,src:t.url,alt:c,containerWidth:u-ae})},`${t.url}-${t.name||""}`)});we.displayName="GalleryItem";export{xt as F,Gt as G,ft as I,Dt as M,$e as P,Bt as W,Qe as a,oe as b,Ft as c,Wt as d,Z as e,Mt as f,dt as m,qe as u};
